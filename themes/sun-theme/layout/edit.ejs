<!--
  themes/your-theme/layout/edit.ejs

  è¯´æ˜ï¼ˆè¯¦ç»†ï¼‰ï¼š
  - ä½œç”¨ï¼šåœ¨æµè§ˆå™¨ä¸­æä¾›ä¸€ä¸ªç®€å•çš„åœ¨çº¿ Markdown ç¼–è¾‘å™¨ï¼Œç”¨æˆ·è¾“å…¥æ–‡ä»¶è·¯å¾„å’Œå†…å®¹åï¼Œ
    å°†é€šè¿‡ fetch è¯·æ±‚æŠŠå†…å®¹æäº¤åˆ°éƒ¨ç½²åœ¨ Vercel ä¸Šçš„ /api/savePost æ¥å£ï¼Œ
    ç”±åç«¯å°†è¯¥å†…å®¹å†™å…¥ GitHub ä»“åº“ï¼ˆé€šå¸¸æ˜¯ Hexo çš„ source ä»“åº“ï¼‰ï¼Œè§¦å‘è‡ªåŠ¨éƒ¨ç½²ã€‚
  - é£é™©æç¤ºï¼ˆé‡è¦ï¼‰ï¼š
    1. å½“å‰é¡µé¢å…è®¸â€œä»»ä½•äººâ€ç›´æ¥ç¼–è¾‘å¹¶æäº¤å†…å®¹ï¼ˆæ— è®¤è¯/æˆæƒï¼‰ï¼Œè¿™ä¼šå¯¼è‡´ä¸¥é‡çš„å®‰å…¨/å†…å®¹ç ´åé£é™©ã€‚
       å¼ºçƒˆå»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¢åŠ ç™»å½•è®¤è¯ï¼ˆä¾‹å¦‚ OAuth / JWT / Cookie ç™»å½•ï¼‰æˆ–è‡³å°‘ä¸€ä¸ªç®€å•çš„ç¼–è¾‘å¯†ç ï¼Œ
       å¹¶åœ¨æœåŠ¡å™¨ç«¯å¯¹æƒé™è¿›è¡Œæ ¡éªŒã€‚
    2. CORS ä¸ API Tokenï¼šåç«¯ä½¿ç”¨çš„ GITHUB_TOKEN å¿…é¡»ä¸¥æ ¼ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯ï¼ˆä¾‹å¦‚ Vercel ç¯å¢ƒå˜é‡ï¼‰ï¼Œ
       ç»ä¸å¯æ”¾å…¥å‰ç«¯ä»£ç æˆ– public ä»“åº“ã€‚å‰ç«¯è¯·æ±‚åªåº”å‘åˆ°ä½ ä¿¡ä»»çš„åç«¯åŸŸåï¼ˆä¸è¦æŠŠåç«¯è®¾ä¸ºå¼€æ”¾çš„è·¨ç«™ç‚¹ä»»æ„æ¥å—ï¼‰ã€‚
    3. è¾“å…¥æ ¡éªŒä¸è·¯å¾„è¿‡æ»¤ï¼šå¿…é¡»åœ¨åç«¯é¢å¤–æ ¡éªŒ filePathï¼Œé¿å…ä»»æ„è·¯å¾„å†™å…¥ï¼ˆåªå…è®¸å†™å…¥ç‰¹å®šç›®å½•ï¼Œå¦‚ source/_posts/ï¼‰ã€‚
    4. æ—¥å¿—ä¸å®¡è®¡ï¼šè®°å½•ç¼–è¾‘è€…ã€æ—¶é—´ã€IPã€æäº¤ä¿¡æ¯ï¼ˆä½†é¿å…è®°å½• tokenï¼‰ï¼Œä»¥ä¾¿å›æ»šæˆ–å®¡è®¡ã€‚
    5. é€Ÿç‡é™åˆ¶ä¸æ»¥ç”¨é˜²æŠ¤ï¼šä¸ºæ¥å£åŠ å…¥é™æµæªæ–½ï¼Œé˜²æ­¢åƒåœ¾æ•°æ®æˆ– DoSã€‚
  - å»ºè®®åŠŸèƒ½æ”¹è¿›ï¼ˆä¼˜å…ˆçº§ï¼‰ï¼š
    1. åœ¨å‰ç«¯åŠ å…¥â€œé¢„è§ˆï¼ˆPreviewï¼‰â€åŠŸèƒ½ï¼ˆè§£æ Markdown ä¸º HTMLï¼‰ï¼Œç¼–è¾‘æ—¶å¯æŸ¥çœ‹æ¸²æŸ“æ•ˆæœã€‚
    2. åœ¨ä¿å­˜å‰è‡ªåŠ¨æ£€æµ‹å¹¶ä¿ç•™æ–‡ç«  Front-Matterï¼ˆYAMLï¼‰æ ¼å¼ï¼Œå¹¶åœ¨è¦†ç›–æ—¶åˆå¹¶è€Œéç›´æ¥æ›¿æ¢ï¼ˆé¿å…ä¸¢å¤± metadataï¼‰ã€‚
    3. åœ¨ä¿å­˜æ—¶å±•ç¤º GitHub è¿”å›çš„ commit URL æˆ– PR é“¾æ¥ï¼ˆå¦‚æœå®ç°ä¸º PR æ¨¡å¼ï¼‰ã€‚
    4. æ”¯æŒå›¾ç‰‡/é™„ä»¶ä¸Šä¼ ï¼ˆå»ºè®®é€šè¿‡åç«¯ä¸Šä¼ åˆ°ä»“åº“æˆ–ä½¿ç”¨ç¬¬ä¸‰æ–¹å›¾åºŠï¼Œå¹¶åœ¨ Markdown ä¸­æ›¿æ¢é“¾æ¥ï¼‰ã€‚
    5. ä½¿ç”¨ @octokit/rest æ›¿ä»£åŸç”Ÿ fetchï¼Œä»¥è·å¾—æ›´å¯é çš„é”™è¯¯å¤„ç†ä¸æ›´å‹å¥½çš„ APIã€‚
-->

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>ç¼–è¾‘æ–‡ç«  | æˆ‘çš„åšå®¢</title>
  <style>
    /* åŸºç¡€æ ·å¼ï¼šè®¾ç½®å­—ä½“å’Œé¡µé¢æœ€å¤§å®½åº¦ï¼Œå±…ä¸­æ˜¾ç¤º */
    body { font-family: sans-serif; max-width: 800px; margin: 30px auto; }
    /* æ–‡æœ¬ç¼–è¾‘åŒºåŸŸæ ·å¼ï¼šè®¾ç½®å®½åº¦å’Œé«˜åº¦ */
    textarea { width: 100%; height: 400px; margin-top: 10px; }
    /* è¾“å…¥æ¡†æ ·å¼ï¼šè®¾ç½®å®½åº¦ã€å¤–è¾¹è·å’Œå†…è¾¹è· */
    input { width: 100%; margin-top: 10px; padding: 8px; }
    /* æŒ‰é’®æ ·å¼ï¼šè®¾ç½®å¤–è¾¹è·ã€å†…è¾¹è·å’Œé¼ æ ‡æ ·å¼ */
    button { margin-top: 10px; padding: 10px 20px; cursor: pointer; }
    /* ç»“æœæ˜¾ç¤ºåŒºåŸŸæ ·å¼ï¼šè®¾ç½®å¤–è¾¹è·å’Œæ–‡æœ¬é¢œè‰²ä¸ºç»¿è‰² */
    .result { margin-top: 10px; color: green; }
  </style>
</head>
<body>
  <h1>åœ¨çº¿ç¼–è¾‘æ–‡ç« </h1>
  <p>ä»»ä½•äººéƒ½å¯ä»¥ä¿®æ”¹æ­¤åšå®¢å†…å®¹ï¼ˆä¿å­˜åè‡ªåŠ¨éƒ¨ç½²ï¼‰</p>

  <input id="filePath" placeholder="æ–‡ä»¶è·¯å¾„ï¼Œä¾‹å¦‚ï¼šsource/_posts/test.md">
  <textarea id="content" placeholder="åœ¨è¿™é‡Œç¼–è¾‘ Markdown å†…å®¹..."></textarea>
  <button id="saveBtn">ğŸ’¾ ä¿å­˜åˆ° GitHub</button>

  <div id="result" class="result"></div>

  <script>
    // ä¸ºä¿å­˜æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
    document.getElementById("saveBtn").onclick = async () => {
      // è·å–æ–‡ä»¶è·¯å¾„å’Œå†…å®¹çš„å€¼ï¼Œå¹¶å»é™¤è·¯å¾„çš„ç©ºç™½å­—ç¬¦
      const filePath = document.getElementById("filePath").value.trim();
      const content = document.getElementById("content").value;
      
      // æ£€æŸ¥æ–‡ä»¶è·¯å¾„å’Œå†…å®¹æ˜¯å¦ä¸ºç©º
      if (!filePath || !content) {
        alert("è¯·è¾“å…¥æ–‡ä»¶è·¯å¾„å’Œå†…å®¹");
        return; // é˜»æ­¢åç»­æ“ä½œ
      }

      // æ›´æ–°ç»“æœåŒºåŸŸï¼Œæ˜¾ç¤ºæ­£åœ¨ä¿å­˜çš„çŠ¶æ€
      document.getElementById("result").textContent = "æ­£åœ¨ä¿å­˜ï¼Œè¯·ç¨å€™...";

      // å‘é€ POST è¯·æ±‚åˆ° Vercel Serverless Function (API)
      const res = await fetch("https://blog-source-lime.vercel.app/api/savePost", {
        method: "POST", // HTTP æ–¹æ³•ä¸º POST
        headers: { "Content-Type": "application/json" }, // è®¾ç½®è¯·æ±‚å¤´ï¼Œè¡¨æ˜å‘é€ JSON æ•°æ®
        body: JSON.stringify({ // å°†æ•°æ®è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²ä½œä¸ºè¯·æ±‚ä½“
          filePath, // æ–‡ä»¶è·¯å¾„
          content,  // æ–‡ç« å†…å®¹
          message: `ç”¨æˆ·åœ¨çº¿æ›´æ–°ï¼š${filePath}`, // GitHub commit æ¶ˆæ¯
        }),
      });

      // è§£æ API è¿”å›çš„ JSON æ•°æ®
      const data = await res.json();
      
      // æ ¹æ® API è¿”å›çš„ success å­—æ®µåˆ¤æ–­æ“ä½œç»“æœ
      if (data.success) {
        // ä¿å­˜æˆåŠŸï¼Œæ›´æ–°ç»“æœæç¤º
        document.getElementById("result").textContent = "âœ… ä¿å­˜æˆåŠŸï¼åšå®¢å°†è‡ªåŠ¨æ›´æ–°ã€‚";
      } else {
        // ä¿å­˜å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        document.getElementById("result").textContent = "âŒ å‘ç”Ÿé”™è¯¯ï¼š" + data.error;
      }
    };
    
    // å¯é€‰æ‰©å±•ï¼ˆTODOï¼‰ï¼š
    // - è‡ªåŠ¨ä¿å­˜è‰ç¨¿ï¼ˆlocalStorageï¼‰ä»¥é˜²æ­¢æµè§ˆå™¨å´©æºƒåæ•°æ®ä¸¢å¤±ã€‚
    // - ç¼–è¾‘å†²çªæç¤ºï¼šåœ¨æäº¤å‰å¯å…ˆè°ƒç”¨ GET /contents/{filePath} è¯»å–æœ€æ–° shaï¼Œåˆ¤æ–­æ˜¯å¦å‘ç”Ÿå˜åŒ–å¹¶æç¤ºç”¨æˆ·åˆå¹¶ã€‚
    // - åœ¨æäº¤å‰è¿›è¡Œ Front-Matter æ ¡éªŒå¹¶æé†’ç¼ºå¤±å¿…éœ€å­—æ®µï¼ˆtitle/date/categoriesï¼‰ã€‚
    // - å¦‚æœå¸Œæœ›æ›´å®‰å…¨ï¼Œå¯æŠŠä¿å­˜åŠ¨ä½œæ”¹ä¸ºï¼šåˆ›å»º Pull Requestï¼ˆåç«¯ç”¨ GitHub API åˆ›å»ºåˆ†æ”¯+æäº¤+PRï¼‰ï¼Œç”±ç®¡ç†å‘˜åˆå¹¶ã€‚
  </script>
</body>
</html>